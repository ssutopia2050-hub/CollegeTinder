<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TextR</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />

    <link rel="stylesheet" href="/dashboard.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
    <a href="#" class="active"><i class="fa-solid fa-house"></i> Home</a>
    <a href="#"><i class="fa-solid fa-comments"></i> TextR</a>
    <a href="#" class="discover"><i class="fa-solid fa-compass"></i> Discover</a>
    <a href="#"><i class="fa-solid fa-photo-film"></i> Media</a>
    <a href="#"><i class="fa-solid fa-gear"></i> Settings</a>
</header>

<!-- ================= MAIN ================= -->
<main class="content">
    <div class="wrapper">

        <!-- PROFILE CARD -->
        <div class="profile-picture-container">
            <img
                    src="<%= profile?.pfp || '/default-pfp.png' %>"
                    alt="Profile Picture"
            >
            <h1 style="color:black"><%= user.name %></h1>
        </div>

        <!-- STATS -->
        <div class="stats-container">
            <div class="likes-display-card">
                <i class="fa-regular fa-heart" style="color:#ffc140;"></i>
                <h1>0</h1>
            </div>

            <div class="followers-display-card">
                <i class="fa-solid fa-user-plus" style="color:#ffc140;"></i>
                <h1>0</h1>
            </div>

            <div class="profile-view-time-display-card">
                <i class="fa-regular fa-hourglass" style="color:#ffc140;"></i>
                <h1>0</h1>
            </div>
        </div>

        <!-- BIO -->
        <div class="personal-bio-container">
            <%= profile?.bio || "No bio added yet." %>
        </div>

        <!-- DETAILS -->
        <div class="personal-details-container">
            <div class="small-card">
                <h1><%= profile?.gender || "â€”" %></h1>
            </div>

            <div class="small-card">
                <h1>21 yrs</h1>
            </div>

            <div class="small-card">
                <h1>Into</h1>
                <h1>Women</h1>
            </div>

            <div class="small-card astrology-sign-display-card">
                <img src="/scorpio.png" alt="">
            </div>
        </div>

        <!-- UPLOADS -->
        <div class="uploads-display-container">

            <!-- Upload Trigger Card (always visible) -->
            <div class="uploaded-image-container upload-trigger">
                <i class="fa-solid fa-plus"></i>
            </div>

            <!-- User uploads - FIXED to use images array -->
            <% if (images && images.length > 0) { %>
                <% images.forEach(img => { %>
                    <div
                        class="uploaded-image-container"
                        data-id="<%= img._id || '' %>"
                        data-liked="<%= img.likedBy && img.likedBy.includes(user._id) ? 'true' : 'false' %>"
                    >
<!--                        <img src="<%= img.url %>" alt="">-->
<!--                        <img src="<%= img.image %>" alt="">-->
                        <img src="<%= img.image %>" alt="">


                    </div>
                <% }) %>
            <% } %>

        </div>
    </div>
</main>

<!-- ================= FOOTER ================= -->
<footer class="footer">
    <div class="footer-box">
        <h3>Social Links</h3>
        <div class="socials">
            <a href="#" class="social instagram"><i class="fa-brands fa-instagram"></i></a>
            <a href="#" class="social x"><i class="fa-brands fa-x-twitter"></i></a>
            <a href="#" class="social youtube"><i class="fa-brands fa-youtube"></i></a>
        </div>
    </div>

    <div class="footer-box">
        <h3>Explore</h3>
        <p>Discover creators</p>
        <p>Trending posts</p>
        <p>Media gallery</p>
    </div>

    <div class="footer-box">
        <h3>About</h3>
        <p>TextR Platform</p>
        <p>Privacy Policy</p>
        <p>Contact</p>
    </div>
</footer>

<!-- ================= GALLERY UPLOAD OVERLAY ================= -->
<div class="overlay" id="uploadOverlay">
    <div class="upload-modal">
        <button class="close-overlay" onclick="document.getElementById('uploadOverlay').style.display='none'">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <h2>Upload Image</h2>

        <form
                class="upload-form"
                action="/upload/gallery"
                method="POST"
                enctype="multipart/form-data"
        >
            <div class="drop-zone" data-input="galleryInput">
                <i class="fa-solid fa-cloud-arrow-up"></i>
                <p>Drag & drop image here</p>
                <span>or click to browse</span>
                <input
                        type="file"
                        id="galleryInput"
                        name="gallery"
                        hidden
                        accept="image/*"
                >
            </div>
        </form>
    </div>
</div>

<!-- ================= PFP UPLOAD OVERLAY ================= -->
<div class="overlay" id="pfpOverlay">
    <div class="upload-modal">
        <button class="close-overlay" onclick="document.getElementById('pfpOverlay').style.display='none'">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <h2>Update Profile Picture</h2>

        <form
                class="upload-form"
                action="/upload-pfp"
                method="POST"
                enctype="multipart/form-data"
        >
            <div class="drop-zone circle" data-input="pfpInput">
                <i class="fa-solid fa-user"></i>
                <p>Drop image here</p>
                <span>or click to browse</span>
                <input type="file" id="pfpInput" name="pfp" hidden accept="image/*">
            </div>
        </form>
    </div>
</div>

<!-- ================= IMAGE VIEW OVERLAY ================= -->
<div class="image-view-overlay" id="imageViewOverlay">
    <button class="close-overlay" onclick="closeImageView()">
        <i class="fa-solid fa-xmark"></i>
    </button>

    <div class="image-view-container">
        <!-- Image Display -->
        <div class="image-display">
            <img id="viewImage" src="" alt="Uploaded Image">
        </div>

        <!-- Action Panel -->
        <div class="action-panel">
            <!-- Like Button -->
            <div class="action-btn like-btn">
                <i class="fa-regular fa-heart"></i>
                <span>Like</span>
            </div>

            <!-- Delete Button -->
            <div class="action-btn delete-btn">
                <i class="fa-solid fa-trash-can"></i>
                <span>Delete</span>
            </div>

            <!-- Image Info -->
            <div class="image-info">
                <p><strong>Status:</strong> <span>Active</span></p>
                <p><strong>Visibility:</strong> <span>Public</span></p>
                <p><strong>Format:</strong> <span>Image</span></p>
            </div>
        </div>
    </div>
</div>

<script src="/dashboard.js"></script>
</body>
</html>
